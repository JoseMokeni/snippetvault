name: Pull Request

on:
  pull_request:
    branches:
      - main

concurrency:
  group: pr-${{ github.event.pull_request.number }}
  cancel-in-progress: true

jobs:
  quality:
    name: Quality Checks
    uses: ./.github/workflows/quality-checks.yml
    permissions:
      contents: read
      security-events: write

  notify:
    name: Notify
    runs-on: ubuntu-latest
    needs: [quality]
    if: always()
    steps:
      - name: Determine status
        id: status
        run: |
          if [[ "${{ needs.quality.result }}" == "success" ]]; then
            echo "status=success" >> $GITHUB_OUTPUT
            echo "color=2067276" >> $GITHUB_OUTPUT
          else
            echo "status=failure" >> $GITHUB_OUTPUT
            echo "color=15158332" >> $GITHUB_OUTPUT
          fi

      - name: Send Discord notification
        uses: sarisia/actions-status-discord@v1
        if: ${{ secrets.DISCORD_WEBHOOK != '' }}
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          status: ${{ steps.status.outputs.status }}
          title: "PR #${{ github.event.pull_request.number }}: ${{ github.event.pull_request.title }}"
          description: |
            **Author:** ${{ github.event.pull_request.user.login }}
            **Branch:** `${{ github.head_ref }}` → `${{ github.base_ref }}`
            
            **Quality Checks:** ${{ needs.quality.result == 'success' && '✅' || '❌' }}
          color: ${{ steps.status.outputs.color }}
          url: ${{ github.event.pull_request.html_url }}


